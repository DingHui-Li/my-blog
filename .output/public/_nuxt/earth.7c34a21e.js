import{W as Y,P as L,S as O,G as T,a as W,M as b,b as j,C as q,I as A,O as C,c as H,d as U,A as V,p as y,e as $,g as J,v as K,D as Q,f as Z}from"./util.e9db9118.js";import{r as ee,o as te,av as oe,l as ne,m as ae,k as se}from"./entry.01da0e6f.js";import{_ as re}from"./_plugin-vue_export-helper.c27b6911.js";const ce={__name:"earth",setup(le){let w=ee(null),f=500,a=f/2,_=null;const i=new Y({alpha:!0,antialias:!0}),m=new L(30,1,1,3e3),h=new O,u=new T;let M=!1;te(async()=>{var e;f=(e=w.value)==null?void 0:e.clientWidth,a=f/2,u.add(E()),u.add(await I()),k(),R(u),S(u)});function k(){oe.get("/api/log/st").then(e=>{var t;console.log(e),u.add(B((t=e.data)==null?void 0:t.filter(o=>o.location.lat)))})}function E(){const e=new W(a,a/2,a/2),t=new b({color:"#05347E",metalness:0,roughness:.8,alphaTest:.02}),o=new j(e,t);return o.position.set(0,0,0),o}async function I(){const e=new q(1.2,5),t=new b({color:"#ffffff",metalness:0,roughness:.9,alphaTest:.02}),o=await G();let s=new A(e,t,o.length);for(let c=0;c<o.length;c++)s.setMatrixAt(c,o[c]);return s.renderOrder=2,s}function B(e=[]){const t=new C,o=[],s=new H(2,2,2);s.translate(0,.5,0),s.rotateX(-Math.PI/2);const c=new U({blending:V,opacity:1,transparent:!1,color:"#D32F2F"});e.forEach(r=>{let p=[r.location.lat,r.location.lon];const d=y(Number(p[0]),Number(p[1]),a);t.position.set(d.x,d.y,d.z);const l=y(Number(p[0]),Number(p[1]),a+5);t.lookAt(l.x,l.y,l.z),t.updateMatrix(),o.push(t.matrix.clone())});let n=new A(s,c,o.length);for(let r=0;r<o.length;r++)n.setMatrixAt(r,o[r]),n.setColorAt(r,new $("#D32F2F"));return n.renderOrder=3,n}async function G(){const e=new C,t=await J("http://blog465467.oss-cn-guangzhou.aliyuncs.com/photo/f6da4eff1610c60e9cfe0c723834685668d677391884eeb87bf428c890f54ade.png"),o=[],s=.16,c=a*.6;for(let n=-90;n<=90;n+=180/c){const d=Math.cos(Math.abs(n)*Z)*a*Math.PI*2*s;for(let l=0;l<d;l++){const x=-180+l*360/d;if(!K(x,n,t))continue;const v=y(n,x,a);e.position.set(v.x,v.y,v.z);const D=y(n,x,a+5);e.lookAt(D.x,D.y,D.z),e.updateMatrix(),o.push(e.matrix.clone())}}return o}function R(e){var o;h.add(e),m.position.set(250,250,1e3),m.lookAt(e.position);const t=new Q(16777215,3);t.position.set(0,0,1),t.target=e,h.add(t),i.setClearAlpha(0),i.setSize(f,f),i.render(h,m),(o=w.value)==null||o.appendChild(i.domElement)}function S(e){_&&clearInterval(_),_=setInterval(()=>{requestAnimationFrame(()=>{i.render(h,m),e.rotateY(.005)})},50)}let g={x:0,y:0};function z(e){e.button==0&&(M=!0,g={x:e.clientX,y:e.clientY})}function F(e){if(M){let t=g.x-e.clientX;g.y-e.clientY,g={x:e.clientX,y:e.clientY},i.render(h,m),u.rotateY(-(t*.002))}}function P(){M=!1}function X(){}function N(){M=!1}return(e,t)=>(se(),ne("div",{class:"earth-container",onMousemove:F,onMousedown:z,onMouseup:P,onMouseenter:X,onMouseleave:N},[ae("div",{class:"earth",ref_key:"earthBoxEl",ref:w},null,512)],32))}},fe=re(ce,[["__scopeId","data-v-20953be2"]]);export{fe as default};
