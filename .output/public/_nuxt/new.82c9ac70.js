import{b as G,E as H}from"./el-message-box.719254f6.js";import{ax as P,a as Q,av as v,r as f,c as z,l as n,m as r,q as c,s as u,F as t,ad as k,ae as x,D as C,af as d,Q as j,ah as J,aw as K,G as O,k as s,v as W,t as w,T as B,ay as V,az as X,aA as Y,aB as Z,U as ee,x as te,y as le}from"./entry.c16f7e93.js";import{_ as oe}from"./RichEditor.5d68a279.js";import{c as se,E as ie}from"./addTopic.31fcc1fd.js";/* empty css                */import{u as $}from"./upload.95c35820.js";import{_ as ae}from"./_plugin-vue_export-helper.c27b6911.js";import{E as ne}from"./index.c980fd33.js";import"./index.66d13a70.js";import"./index.38034195.js";import"./_commonjsHelpers.725317a4.js";import"./el-form.c192d8f5.js";import"./debounce.3d1281f4.js";import"./index.bcbb4fa8.js";import"./vnode.1ba59ce8.js";import"./aria.bc8e8b0f.js";const M=_=>(te("data-v-6e4c37f1"),_=_(),le(),_),ce={class:"new-article"},re={class:"actions"},de={class:"container"},pe={class:"form-item"},ue=M(()=>r("div",{class:"label"},"类型",-1)),_e={class:"topics"},me=["onClick"],ve={key:0,class:"cover"},fe=["src"],he={class:"form-item"},ge=M(()=>r("div",{class:"label"},"标签",-1)),ye={class:"topics"},ke=["onClick"],xe={class:"topic"},Ce={key:1,class:"title"},we={class:"content"},Ee={key:0},be={key:2,class:"imgs"},Ie={class:"item"},Te={key:0,class:"loading"},ze={key:0,class:"item"},Be={__name:"new",setup(_){const E=P(),q=Q();E.query.id&&v.get(`/api/article/${E.query.id}`).then(l=>{e.value=l.data});let h=f(null),g=f(!1),e=f({cover:"",title:"",htmlContent:"",textContent:"",topics:[],type:"moment",imgs:[]}),b=f([]),N=[{label:"动态",key:"moment"},{label:"文章",key:"article"}];T();let S=z(()=>{let l={};return e.value.topics.forEach(o=>{l[o._id]=!0}),l}),I=z(()=>e.value.type=="photo"?99:9);function T(){v.get("/api/topic").then(l=>{b.value=l==null?void 0:l.data})}function D(l){let o=e.value.topics.findIndex(i=>i._id==l._id);o>=0?e.value.topics.splice(o,1):e.value.topics.push(l)}function L(l){let o=l.target.files;o.length&&$(o[0],"article/cover").then(i=>{e.value.cover=i}),l.value=""}async function R(l){console.log(l);let o="photo";e.value.type=="photo"&&(o+=`/${e.value.title}`);for(let i=0;i<l.target.files.length&&!(e.value.imgs.length>I.value);i++){const p=l.target.files[i];await $(p,o).then(y=>{e.value.imgs.push(y)})}l.target.value=""}function U(){g.value=!0;let l={...e.value,topics:e.value.topics.map(i=>i._id)};e.value.type=="article"?(l.textContent=h.value.getPureText(),l.htmlContent=h.value.getHtmlContent()):l.textContent=e.value.htmlContent;let o;e.value._id?o=v.put("/api/admin/article",l):o=v.post("/api/admin/article",l),o.then(i=>{ne.alert("操作成功","提示",{confirmButtonText:"确定",callback:()=>{q.back()}})}).catch(i=>{K.error((i==null?void 0:i.msg)||"未知错误")}).finally(()=>{g.value=!1})}return(l,o)=>{const i=G,p=O,y=H,A=oe,F=ie;return s(),n("div",ce,[r("div",re,[c(i,{class:"btn confirm",type:"primary",onClick:U,loading:t(g)},{default:u(()=>[W(w(t(e)._id?"保存":"发布"),1)]),_:1},8,["loading"])]),r("div",de,[r("div",pe,[ue,r("div",_e,[(s(!0),n(k,null,x(t(N),a=>(s(),n("div",{class:B(["topic type",`${t(e).type==a.key&&"active"}`]),onClick:m=>t(e).type=a.key},w(a.label),11,me))),256))])]),t(e).type=="article"?(s(),n("div",ve,[t(e).cover?d("",!0):(s(),C(p,{key:0,size:"35"},{default:u(()=>[c(t(V))]),_:1})),t(e).cover?(s(),n("img",{key:1,src:t(e).cover},null,8,fe)):d("",!0),r("input",{type:"file",accept:"image/*",onChange:L,style:{position:"absolute",width:"100%",height:"100%",opacity:"0"}},null,32)])):d("",!0),r("div",he,[ge,r("div",ye,[(s(!0),n(k,null,x(t(b),a=>(s(),n("div",{class:B(["topic",t(S)[a._id]&&"active"]),onClick:m=>D(a)},w(a.name),11,ke))),256)),c(t(se),{onConfirm:T},{default:u(()=>[r("div",xe,[c(p,{size:"15"},{default:u(()=>[c(t(X))]),_:1})])]),_:1})])]),t(e).type=="article"?(s(),n("div",Ce,[c(y,{class:"input",placeholder:"请输入文章标题",modelValue:t(e).title,"onUpdate:modelValue":o[0]||(o[0]=a=>t(e).title=a),maxlength:100,"show-word-limit":""},null,8,["modelValue"])])):d("",!0),r("div",we,[t(e).type=="article"?(s(),n("div",Ee,[c(A,{ref_key:"richEditorEl",ref:h,value:t(e).htmlContent},null,8,["value"])])):d("",!0),t(e).type=="moment"?j((s(),n("textarea",{key:1,class:"textarea","onUpdate:modelValue":o[1]||(o[1]=a=>t(e).htmlContent=a),placeholder:"内容",maxlength:"800"},null,512)),[[J,t(e).htmlContent]]):d("",!0)]),t(e).type!="article"?(s(),n("div",be,[(s(!0),n(k,null,x(t(e).imgs,(a,m)=>(s(),n("div",Ie,[a?(s(),C(F,{key:1,"preview-teleported":!0,"initial-index":m,style:{width:"100%",height:"100%"},fit:"cover",src:a+"?x-oss-process=image/resize,m_fill,w_400","preview-src-list":t(e).imgs},null,8,["initial-index","src","preview-src-list"])):(s(),n("div",Te,[c(p,{class:"icon",size:"25"},{default:u(()=>[c(t(Y))]),_:1})])),a?(s(),C(p,{key:2,class:"clear",size:30,onClick:ee(Ve=>t(e).imgs.splice(m,1),["stop"])},{default:u(()=>[c(t(Z))]),_:2},1032,["onClick"])):d("",!0)]))),256)),t(e).imgs.length<t(I)?(s(),n("div",ze,[r("input",{class:"input",type:"file",multiple:"",accept:"image/*",onChange:R},null,32),c(p,{size:"20"},{default:u(()=>[c(t(V))]),_:1})])):d("",!0)])):d("",!0)])])}}},Je=ae(Be,[["__scopeId","data-v-6e4c37f1"]]);export{Je as default};
