import{_ as u}from"./_plugin-vue_export-helper.c27b6911.js";import{k as m,l as a,m as r,Y as c,t as d,B as f}from"./entry.68178e43.js";const I={props:{src:String,thumb:String,alt:String,w:Number|String,h:Number|String,fit:{type:String,default:"cover"},title:String,transitionDuration:{type:Number,default:300}},data(){return{containerWidth:0,timer:null,clicks:0,open:!1,zoom:!1,originImgRect:{top:0,left:0,width:0,height:0},animeing:!1,touch:{active:!1,start:{x:0,y:0},end:{x:0,y:0}},imgListTouch:{active:!1,start:{x:0,y:0},end:{x:0,y:0}},scale:1,imgNodeList:[],imgList:[],imgIndex:0,currentIndex:0,imgListTranslateX:0}},mounted(){this.containerWidth=this.$refs.el.clientWidth;const i=this.$refs.vimg.parentNode;for(let t=0;t<i.children.length;t++){const e=i.children[t];if(e.classList.contains("vue-img-com-vvcx")){this.imgNodeList.push(e);const n=e.children[0].src;this.imgList.push(n),n==this.$refs.img.src&&(this.imgIndex=t,this.currentIndex=t)}}},computed:{style(){return`width:${this.w}`},imgStyle(){let i=isNaN(this.w)?this.w:this.w+"px",t=isNaN(this.h)?this.h:this.h+"px";return`object-fit:${this.fit};width:${i||"100%"};height:${t||"auto"};`},originImgEl(){return this.imgNodeList[this.currentIndex].children[0]},zoomImgCenterRect(){console.log(document.body.clientHeight);let i=this.$refs.el.clientHeight,t=this.$refs.el.clientWidth,e=this.zoomImgEl.naturalHeight,n=this.zoomImgEl.naturalWidth;if(i>t)n=t>750?750:t,e=e/this.zoomImgEl.naturalWidth*n;else{const s=i-20;e=e>s?s:e,n=n/this.zoomImgEl.naturalHeight*e,console.log(n,e)}let h=i/2-e/2;return h=h<0?0:h,{top:h,left:t/2-n/2,width:n,height:e}},zoomImgEl(){return this.$refs.zoomImg[this.currentIndex]||this.$refs.zoomImg},maxTranslateWidth(){return this.containerWidth*(this.imgList.length-1)||0},imgListMoveDistance(){return this.imgListTouch.start.x-this.imgListTouch.end.x||0}},watch:{open(i){this.$nextTick(()=>{i?(this.currentIndex=this.imgIndex,document.body.style.overflow="hidden",requestAnimationFrame(this.showZoomImg)):(setTimeout(()=>{document.body.style.overflow="auto"},100),requestAnimationFrame(this.hideZoomImg))})},currentIndex:{handler(i,t){this.open&&(this.getOriginImgInfo(),this.setZoomImgRect(this.zoomImgCenterRect)),this.imgNodeList.length&&(this.imgNodeList[t].children[0].style.opacity=1),this.$refs.imglist&&(this.$refs.imglist.style.transition="all .5s"),this.imgListTranslateX=-(this.containerWidth*this.currentIndex)},immediate:!0}},methods:{getOriginImgInfo(){let i=this.originImgEl.getBoundingClientRect();this.originImgRect=i},setZoomImgRect(i,t=0){this.zoomImgEl.style.cssText=`
            transition:all ${t}ms;
            top:${i.top}px;left:${i.left}px;
            width:${i.width}px;height:${i.height}px;
            transform:translate(0,0);
            `},anime(i,t=0){return new Promise(e=>{i(),setTimeout(()=>{e()},t)})},showZoomImg(){this.animeing=!0,document.body.appendChild(this.$refs.el),this.anime(()=>{this.getOriginImgInfo(),this.setZoomImgRect(this.originImgRect)}).then(()=>this.anime(()=>{this.setZoomImgRect(this.zoomImgCenterRect,this.transitionDuration),this.$refs.el.classList.add("open"),this.originImgEl.style.opacity=0,this.$refs.mask.style.opacity=1},this.transitionDuration)).then(()=>{this.animeing=!1})},hideZoomImg(){this.animeing=!0,this.$refs.mask.style.opacity=0,this.getOriginImgInfo(),this.anime(()=>this.setZoomImgRect(this.originImgRect,this.transitionDuration),this.transitionDuration).then(()=>this.anime(()=>{this.$refs.el.classList.remove("open"),this.originImgEl.style.opacity=1},100)).then(()=>{setTimeout(()=>{this.teleport=!1},1e3);try{document.body.removeChild(this.$refs.el)}catch(i){console.log(i)}this.animeing=!1})},imgClick(i){this.clicks++,this.clicks===1?this.timer=setTimeout(()=>{this.clicks=0,this.close(i)},200):this.clicks===2&&(clearTimeout(this.timer),this.clicks=0,this.dblclick(i))},handleClick(){this.animeing||(this.open?this.zoom||(this.open=!1):this.open=!0)},close(){const i=this.touch.start,t=this.touch.end;this.imgListMoveDistance==0&&(this.scale!=1||i.x!=t.x&&i.y!=t.y||(this.open=!1))},dblclick(i){this.scale=this.scale==1?2:1,this.scale==1?(this.getOriginImgInfo(),this.setZoomImgRect(this.zoomImgCenterRect)):(this.zoomImgEl.style.transition="all .3s",this.zoomImgEl.style.transform=`scale(${this.scale})`,this.zoomImgEl.style.transformOrigin=`${i.layerX}px ${i.layerY}px`)},touchStart(i){let t=this.getPointPos(i);this.touch={active:!0,start:t,end:t}},touchMove(i){if(!this.touch.active)return;let t=this.getPointPos(i);const e=(this.touch.end.x-t.x)/1.2,n=(this.touch.end.y-t.y)/1.2;this.touch.end=t;let h=Number(this.zoomImgEl.style.top.replace("px","")),s=Number(this.zoomImgEl.style.left.replace("px","")),o=h-n,g=s-e;if(this.zoomImgEl.style.transition="none",this.scale!=1)this.zoomImgEl.style.top=o+"px",this.zoomImgEl.style.left=g+"px";else if(this.imgListMoveDistance<5){this.zoomImgEl.style.top=o+"px";let l=Math.abs(this.touch.start.y-this.touch.end.y)/1e3;l=l>.5?.5:l,this.zoomImgEl.style.transform=`scale(${1-l})`,this.$refs.mask.style.opacity=1-l}},touchEnd(i){if(this.touch.active=!1,this.scale==1){const t=this.touch.start.y-this.touch.end.y;Math.abs(t)>50?this.open=!1:this.imgListMoveDistance==0&&(this.getOriginImgInfo(),this.setZoomImgRect(this.zoomImgCenterRect))}},touchcancel(i){this.touch.active=!1},onMouseWheel(i){},getPointPos(i){var n,h;let t=i.clientX,e=i.clientY;return i.type.includes("touch")&&(t=((n=i.touches[0])==null?void 0:n.clientX)||0,e=((h=i.touches[0])==null?void 0:h.clientY)||0),{x:t,y:e}},imgListTouchStart(i){let t=this.getPointPos(i);this.imgListTouch={active:!0,start:t,end:t}},imgListTouchMove(i){let t=this.getPointPos(i);if(this.scale==1&&this.imgListTouch.active){const e=-(this.imgListTouch.end.x-t.x)||0;this.imgListTouch.end=t,this.$refs.imglist.style.transition="none";let n=this.imgListTranslateX+e;const h=100,s=-(this.maxTranslateWidth+100);n=n>h?h:n<s?s:n,this.imgListTranslateX=n}},imgListTouchEnd(i){this.imgListTouch.active=!1,this.$refs.imglist.style.transition="all .5s";let t=this.imgListTranslateX<-this.maxTranslateWidth?-this.maxTranslateWidth:this.imgListTranslateX>0?0:this.imgListTranslateX;if(this.imgListTranslateX=t,this.imgListMoveDistance>50){let e=this.currentIndex+1;e=e>this.imgList.length-1?this.imgList.length-1:e,this.currentIndex=e}else if(this.imgListMoveDistance<-50){let e=this.currentIndex-1;e=e<0?0:e,this.currentIndex=e}else this.imgListTranslateX=-(this.containerWidth*this.currentIndex)},imgListTouchcancel(i){this.imgListTouchEnd()}}},y=["src","alt"],x={key:0,class:"title"},v=["src"],L={ref:"mask",class:"v-img-mask"};function T(i,t,e,n,h,s){return m(),a("div",{ref:"vimg",class:"v-img vue-img-com-vvcx",onClick:t[10]||(t[10]=(...o)=>s.handleClick&&s.handleClick(...o)),style:c(s.style)},[r("img",{ref:"img",class:"img",src:e.thumb||e.src,alt:e.alt,style:c(`${s.imgStyle}`)},null,12,y),e.title?(m(),a("div",x,d(e.title),1)):f("",!0),r("div",{onClick:t[9]||(t[9]=(...o)=>s.imgClick&&s.imgClick(...o)),ref:"el",class:"v-img-zoom"},[r("img",{ref:"zoomImg",class:"zoom-img",onWheel:t[0]||(t[0]=(...o)=>s.onMouseWheel&&s.onMouseWheel(...o)),src:e.src,draggable:!1,onMousedown:t[1]||(t[1]=(...o)=>s.touchStart&&s.touchStart(...o)),onTouchstart:t[2]||(t[2]=(...o)=>s.touchStart&&s.touchStart(...o)),onMousemove:t[3]||(t[3]=(...o)=>s.touchMove&&s.touchMove(...o)),onTouchmove:t[4]||(t[4]=(...o)=>s.touchMove&&s.touchMove(...o)),onTouchend:t[5]||(t[5]=(...o)=>s.touchEnd&&s.touchEnd(...o)),onMouseup:t[6]||(t[6]=(...o)=>s.touchEnd&&s.touchEnd(...o)),onMouseover:t[7]||(t[7]=(...o)=>s.touchcancel&&s.touchcancel(...o)),onTouchcancel:t[8]||(t[8]=(...o)=>s.touchcancel&&s.touchcancel(...o))},null,40,v),r("div",L,null,512)],512)],4)}const E=u(I,[["render",T],["__scopeId","data-v-a4bd9be3"]]);export{E as _};
