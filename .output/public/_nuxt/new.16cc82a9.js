import{b as F,E as G}from"./el-overlay.a9f8551b.js";import{ay as H,a as P,$ as v,r as h,c as V,l as n,m as r,q as c,s as u,A as t,ag as k,ah as C,G as x,B as d,S as W,aj as J,ax as K,I as O,k as s,v as Q,t as w,V as z,az as T,aA as X,aB as Y,aC as Z,W as ee,x as te,y as le}from"./entry.68178e43.js";import{_ as oe}from"./RichEditor.7738a6c2.js";import{c as se,E as ie}from"./addTopic.85dee60e.js";/* empty css                */import{u as $}from"./upload.c8fe3ea7.js";import{_ as ae}from"./_plugin-vue_export-helper.c27b6911.js";import{E as ne}from"./index.e1ac7418.js";import"./index.2c8df682.js";import"./index.38034195.js";import"./_commonjsHelpers.725317a4.js";import"./el-form.3f8bc4ed.js";import"./debounce.b524432a.js";import"./index.1ad8d987.js";import"./vnode.a9c3e3aa.js";import"./aria.bc8e8b0f.js";const M=_=>(te("data-v-6e4c37f1"),_=_(),le(),_),ce={class:"new-article"},re={class:"actions"},de={class:"container"},pe={class:"form-item"},ue=M(()=>r("div",{class:"label"},"类型",-1)),_e={class:"topics"},me=["onClick"],ve={key:0,class:"cover"},he=["src"],fe={class:"form-item"},ge=M(()=>r("div",{class:"label"},"标签",-1)),ye={class:"topics"},ke=["onClick"],Ce={class:"topic"},xe={key:1,class:"title"},we={class:"content"},Ee={key:0},Ie={key:2,class:"imgs"},be={class:"item"},Be={key:0,class:"loading"},Ve={key:0,class:"item"},ze={__name:"new",setup(_){const E=H(),S=P();E.query.id&&v.get(`/api/article/${E.query.id}`).then(l=>{e.value=l.data});let f=h(null),g=h(!1),e=h({cover:"",title:"",htmlContent:"",textContent:"",topics:[],type:"moment",imgs:[]}),I=h([]),q=[{label:"动态",key:"moment"},{label:"文章",key:"article"}];B();let N=V(()=>{let l={};return e.value.topics.forEach(o=>{l[o._id]=!0}),l}),b=V(()=>e.value.type=="photo"?99:9);function B(){v.get("/api/topic").then(l=>{I.value=l==null?void 0:l.data})}function A(l){let o=e.value.topics.findIndex(i=>i._id==l._id);o>=0?e.value.topics.splice(o,1):e.value.topics.push(l)}function L(l){let o=l.target.files;o.length&&$(o[0],"article/cover").then(i=>{e.value.cover=i}),l.value=""}async function R(l){console.log(l);let o="photo";e.value.type=="photo"&&(o+=`/${e.value.title}`);for(let i=0;i<l.target.files.length&&!(e.value.imgs.length>b.value);i++){const p=l.target.files[i];await $(p,o).then(y=>{e.value.imgs.push(y)})}l.target.value=""}function D(){g.value=!0;let l={...e.value,topics:e.value.topics.map(i=>i._id)};e.value.type=="article"?(l.textContent=f.value.getPureText(),l.htmlContent=f.value.getHtmlContent()):l.textContent=e.value.htmlContent;let o;e.value._id?o=v.put("/api/admin/article",l):o=v.post("/api/admin/article",l),o.then(i=>{ne.alert("操作成功","提示",{confirmButtonText:"确定",callback:()=>{S.back()}})}).catch(i=>{K.error((i==null?void 0:i.msg)||"未知错误")}).finally(()=>{g.value=!1})}return(l,o)=>{const i=F,p=O,y=G,U=oe,j=ie;return s(),n("div",ce,[r("div",re,[c(i,{class:"btn confirm",type:"primary",onClick:D,loading:t(g)},{default:u(()=>[Q(w(t(e)._id?"保存":"发布"),1)]),_:1},8,["loading"])]),r("div",de,[r("div",pe,[ue,r("div",_e,[(s(!0),n(k,null,C(t(q),a=>(s(),n("div",{class:z(["topic type",`${t(e).type==a.key&&"active"}`]),onClick:m=>t(e).type=a.key},w(a.label),11,me))),256))])]),t(e).type=="article"?(s(),n("div",ve,[t(e).cover?d("",!0):(s(),x(p,{key:0,size:"35"},{default:u(()=>[c(t(T))]),_:1})),t(e).cover?(s(),n("img",{key:1,src:t(e).cover},null,8,he)):d("",!0),r("input",{type:"file",accept:"image/*",onChange:L,style:{position:"absolute",width:"100%",height:"100%",opacity:"0"}},null,32)])):d("",!0),r("div",fe,[ge,r("div",ye,[(s(!0),n(k,null,C(t(I),a=>(s(),n("div",{class:z(["topic",t(N)[a._id]&&"active"]),onClick:m=>A(a)},w(a.name),11,ke))),256)),c(t(se),{onConfirm:B},{default:u(()=>[r("div",Ce,[c(p,{size:"15"},{default:u(()=>[c(t(X))]),_:1})])]),_:1})])]),t(e).type=="article"?(s(),n("div",xe,[c(y,{class:"input",placeholder:"请输入文章标题",modelValue:t(e).title,"onUpdate:modelValue":o[0]||(o[0]=a=>t(e).title=a),maxlength:100,"show-word-limit":""},null,8,["modelValue"])])):d("",!0),r("div",we,[t(e).type=="article"?(s(),n("div",Ee,[c(U,{ref_key:"richEditorEl",ref:f,value:t(e).htmlContent},null,8,["value"])])):d("",!0),t(e).type=="moment"?W((s(),n("textarea",{key:1,class:"textarea","onUpdate:modelValue":o[1]||(o[1]=a=>t(e).htmlContent=a),placeholder:"内容",maxlength:"800"},null,512)),[[J,t(e).htmlContent]]):d("",!0)]),t(e).type!="article"?(s(),n("div",Ie,[(s(!0),n(k,null,C(t(e).imgs,(a,m)=>(s(),n("div",be,[a?(s(),x(j,{key:1,"preview-teleported":!0,"initial-index":m,style:{width:"100%",height:"100%"},fit:"cover",src:a+"?x-oss-process=image/resize,m_fill,w_400","preview-src-list":t(e).imgs},null,8,["initial-index","src","preview-src-list"])):(s(),n("div",Be,[c(p,{class:"icon",size:"25"},{default:u(()=>[c(t(Y))]),_:1})])),a?(s(),x(p,{key:2,class:"clear",size:30,onClick:ee(Te=>t(e).imgs.splice(m,1),["stop"])},{default:u(()=>[c(t(Z))]),_:2},1032,["onClick"])):d("",!0)]))),256)),t(e).imgs.length<t(b)?(s(),n("div",Ve,[r("input",{class:"input",type:"file",multiple:"",accept:"image/*",onChange:R},null,32),c(p,{size:"20"},{default:u(()=>[c(t(T))]),_:1})])):d("",!0)])):d("",!0)])])}}},Je=ae(ze,[["__scopeId","data-v-6e4c37f1"]]);export{Je as default};
